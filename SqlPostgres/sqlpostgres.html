<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Lista de Comados de Programação da
    Linguagem de Banco de Dados: PostgreSql, lista criada por um estudante de
    curso técnico 'Germinatech'"
    />
    <title>SqlPostgres</title>
    <link
      rel="shortcut icon"
      href="../Imagens/icone_pg.webp"
      type="image/x-icon"
    />

    <link rel="stylesheet" href="../Estilos/Minificado/variaveis.css" />
    <link rel="stylesheet" href="../Estilos/Minificado/cabecalho.css" />
    <link rel="stylesheet" href="../Estilos/Minificado/secundario.css" />

    <style>
      section p {
        min-height: 100px;
      }

      section strong {
        margin-bottom: 8px;
      }
    </style>

    <script src="../Estilos/Minificado/cabecalhoHtml.js" defer></script>
    <script src="../Estilos/Minificado/cabecalho.js" defer></script>
    <script src="../Estilos/Minificado/secundario.js" defer></script>
  </head>
  <body data-page="sqlpostgres">
    <div id="cabecalhoFixo"></div>

    <header id="falso"></header>

    <main>
      <h1></h1>
      <div id="botoesContainer">
        <select
          name="opcoes"
          id="opcoes"
          aria-label="Seleção das seções da página"
          onchange="location = this.value"
        >
          <option value="#docker">Docker e bancos</option>
          <option value="#tabelas">Tabelas</option>
          <option value="#colunas">Colunas</option>
          <option value="#valores">Valores</option>
          <option value="#chaves">Chaves e Serial</option>
          <option value="#selects">Selects</option>
          <option value="#fNumeros">Funções de Numbers</option>
          <option value="#fString">Funções de Strings</option>
          <option value="#fPessoal">Funções de Pessoais</option>
          <option value="#user">Privilégios (1)</option>
          <option value="#grant">Privilégios (2)</option>
          <option value="#view">View e Trigger</option>
          <option value="#procedure">Procedure</option>
          <option value="#json">Json</option>
        </select>
        <button id="btnAbrir"></button>
      </div>
      <section>
        <button id="docker">
          <img src="../Imagens/circulo1.webp" alt="icone de circulo com seta" />
          <h3>Docker e bancos:</h3>
        </button>
        <div class="conteudo">
          <p>
            <strong>Iniciar o container pg (deixar pg no verde):</strong>
            docker start pg
          </p>
          <p>
            <strong>Executar a instância (entrar no root):</strong>
            docker exec -it pg bash
          </p>
          <p>
            <strong>Entrar no postgres:</strong>
            psql -U postgres
          </p>
          <p>
            <strong>Sair do postgres:</strong>
            \q
          </p>
          <p>
            <strong>Ver quais bancos existem:</strong>
            \l
          </p>
          <p>
            <strong>Criar banco dbMercado: </strong>
            createdb dbMercado -U postgres
          </p>
          <p>
            <strong>Entrar no banco (dentro do root):</strong>
            psql dbGerminare -U postgres
          </p>
          <p>
            <strong>Apagar banco: </strong>
            dropdb dbPratica -U postgres
          </p>
        </div>
      </section>
      <section>
        <button>
          <img src="../Imagens/circulo1.webp" alt="icone de circulo com seta" />
          <h3>Tabelas:</h3>
        </button>
        <div class="conteudo">
          <p>
            <strong>Ver quais tabelas existem:</strong>
            \dt
          </p>
          <p>
            <strong>
              Ver o tipo da tabela (adicione o nome da tabela depois de \d):
            </strong>
            \d
          </p>
          <p>
            <strong>Criar tabela:</strong>
            CREATE TABLE aluno <br />( codigo DECIMAL, <br />
            nome VARCHAR (80), <br />
            cpf BIGINT, <br />
            idade INT, <br />
            media REAL, <br />
            verdade BOOL, <br />
            data_mat DATE, <br />
            hora_nascimento TIMESTAMP);
          </p>
          <p>
            <strong>Criar tabela (com herança):</strong>
            CREATE TABLE industrializado <br />
            ( embalagem VARCHAR (20)) <br />
            inherits (alimento);
          </p>
          <p>
            <strong>Renomear tabela:</strong>
            ALTER TABLE professor <br />
            RENAME TO professores;
          </p>
          <p>
            <strong>Apagar tabela:</strong>
            DROP TABLE professor;
          </p>
        </div>
      </section>
      <section>
        <button id="colunas">
          <img src="../Imagens/circulo1.webp" alt="icone de circulo com seta" />
          <h3>Colunas:</h3>
        </button>
        <div class="conteudo">
          <p>
            <strong>Adicionar coluna:</strong>
            ALTER TABLE professor <br />
            ADD COLUMN sobrenome VARCHAR (80);
          </p>
          <p>
            <strong>Apagar coluna:</strong>
            ALTER TABLE professor <br />
            DROP COLUMN sobrenome;
          </p>
          <p>
            <strong>Renomear coluna:</strong>
            ALTER TABLE professor <br />
            RENAME data_contratacao TO contraste;
          </p>
          <p>
            <strong>Renomear coluna temporariamente (aliás):</strong>
            SELECT nomes AS professores <wbr />
            FROM professor;
          </p>
          <p>
            <strong>Mudar o tipo da coluna (somente se compatível):</strong>
            ALTER TABLE professor <br />
            ALTER COLUMN idade REAL;
          </p>
          <p>
            <strong>Adicionar um valor máximo para uma coluna:</strong>
            ALTER TABLE aluno <br />
            ADD CHECK (media &lt; 10);
          </p>
          <p>
            <strong>Ver todas as colunas da tabela:</strong>
            SELECT * FROM professor
          </p>
          <p>
            <strong>Verificar se é par ou ímpar:</strong>
            SELECT CASE WHEN (4 % 2 = 0) THEN 'par' ELSE 'impar' END;
          </p>
          <p>
            <strong>
              Adicionar uma nova coluna temporariamente com uma condição:
            </strong>
            SELECT *, CASE <br />
            WHEN media = 10 THEN 'Você tirou 10' <br />
            WHEN media > 7 THEN 'Você passou, mas não foi 10' <br />
            ELSE 'Você não passou' <br />
            END AS mensagem FROM aluno;
          </p>
        </div>
      </section>
      <section>
        <button id="valores">
          <img src="../Imagens/circulo1.webp" alt="icone de circulo com seta" />
          <h3>Valores:</h3>
        </button>
        <div class="conteudo">
          <p>
            <strong>Colocar/inserir valores: </strong>
            INSERT INTO aluno (id, nome) <br />
            VALUES (1, 'André), (2, 'Ana');
          </p>
          <p>
            <strong>Olhar valores de diferentes tabelas:</strong>
            SELECT aluno.academias, academias.nome FROM aluno, academias
            <br />
            WHERE aluno.academias= academias.id;
          </p>
          <p>
            <strong>
              Trocar os valores, (apenas no Rodrigo nesse caso):
            </strong>
            UPDATE professor <br />
            SET idade=30, salario=2000 <br />
            WHERE nome LIKE 'Rodrigo';
          </p>
          <p>
            <strong>Apagar todos os valores:</strong>
            TRUNCATE TABLE professor;
          </p>
          <p>
            <strong>Deletar/apagar valores só de 1 linha:</strong>
            DELETE FROM aluno <br />
            WHERE nome LIKE 'Rodrigo';
          </p>
          <p>
            <strong>Colocar/inserir valores de outra tabela:</strong>
            INSERT INTO professor (cpf, nome, idade) <br />
            SELECT INTO aluno.cpf, aluno.nome, aluno.idade FROM aluno;
          </p>
        </div>
      </section>
      <section>
        <button id="chaves">
          <img src="../Imagens/circulo1.webp" alt="icone de circulo com seta" />
          <h3>Chaves e Serial:</h3>
        </button>
        <div class="conteudo">
          <p>
            <strong>
              Criar tabela com chave primária (pode trocar INT por SERIAL):
            </strong>
            CREATE TABLE produtos ( <br />
            id INT PRIMARY KEY, <br />
            nome VARCHAR (80), <br />
            preco REAL);
          </p>
          <p>
            <strong>Criar tabela com chave estrangeira:</strong>
            CREATE TABLE aluno ( <br />
            coluna INT REFERENCES professor);
          </p>
          <p>
            <strong>Reiniciar SERIAL:</strong>
            TRUNCATE TABLE professor RESTART IDENTITY;
          </p>
          <p>
            <strong>Adicionar a restrição de not null:</strong>
            ALTER TABLE aluno <br />
            ALTER COLUMN nome SET NOT NULL;
          </p>
          <p>
            <strong>
              Criar tabela com 2 chaves primárias (chave composta) e 2 chaves
              estrangeiras (modo alterno):
            </strong>
            CREATE TABLE notas_avv ( <br />
            id_aluno INT, <br />
            id_professor INT, <br />
            nota REAL, <br />
            PRIMARY KEY (id_aluno, id_professor), <br />
            FOREIGN KEY (id_aluno) REFERENCES aluno, <br />
            FOREIGN KEY (id_professor) REFERENCES professor);
          </p>
        </div>
      </section>
      <section>
        <button id="selects">
          <img src="../Imagens/circulo1.webp" alt="icone de circulo com seta" />
          <h3>Editar Selects:</h3>
        </button>
        <div class="conteudo">
          <p>
            <strong>Ver colunas específicas:</strong>
            SELECT nome, idade FROM aluno;
          </p>
          <p>
            <strong>Somar colunas (a idade com o salario):</strong>
            SELECT nomes, idade + salario FROM professor;
          </p>
          <p>
            <strong>
              Ver colunas tenham 1 OU outra coluna igual (aceita símbolo de =,
              &gt;, &lt;, != depois de OR):
            </strong>
            SELECT nome, sobrenome FROM aluno WHERE id=1 OR idade > 16;
          </p>
          <p>
            <strong>
              Ver colunas tenham 1 E outra coluna igual (aceita símbolo de =,
              &gt;, &lt;, != depois de AND):
            </strong>
            SELECT nome, sobrenome FROM aluno WHERE nome= 'Ana' AND idade &lt;=
            16;
          </p>
          <p>
            <strong>
              Ordenar por ordem alfabética ou crescente (adicione DESC depois da
              coluna para inverter):
            </strong>
            SELECT * FROM aluno ORDER BY nome, idade;
          </p>
          <p>
            <strong>
              Ver algo entre certos valores (adicione NOT antes de BETWEEN para
              ser entre 0 a 6):
            </strong>
            SELECT * FROM aluno WHERE media BETWEEN 7 AND 10;
          </p>
          <p>
            <strong>
              Filtrar com um limite (os 3 melhores, tirando os 2 primeiros):
            </strong>
            SELECT * FROM professor ORDER BY id LIMIT 3 OFFSET 2;
          </p>
          <p>
            <strong>
              Ver colunas que começam com uma letra única (S) (optar LIKE por
              SIMILAR TO):
            </strong>
            SELECT * FROM aluno WHERE nome LIKE 'S%';
          </p>
          <p>
            <strong>Não mostrar resultados repetidos:</strong>
            SELECT DISTINCT academias FROM professor;
          </p>
          <p>
            <strong>
              Pegar as informações encontrados só na tabela produto (herança):
            </strong>
            SELECT * FROM ONLY produto;
          </p>
        </div>
      </section>
      <section>
        <button id="fNumeros">
          <img src="../Imagens/circulo1.webp" alt="icone de circulo com seta" />
          <h3>Funções de Numbers:</h3>
        </button>
        <div class="conteudo">
          <p><strong>Módulo:</strong> SELECT abs (-3);</p>
          <p>
            <strong>Potência (2 <sup>10</sup> ):</strong>
            SELECT power (2,10);
          </p>
          <p>
            <strong>
              Definir os decimais (round para arredondar, e trunc para eliminar)
              (,3 = casas dps da virgula):
            </strong>
            SELECT round (3.39812, 3);
          </p>
          <p>
            <strong>Arredondar (ceil para acima, floor para baixo):</strong>
            SELECT ceil (10.9);
          </p>
          <p>
            <strong>Converter inteiro em decimal:</strong>
            SELECT nome, trunc (cast (media AS decimal),2) AS media_em_decimal
            FROM aluno;
          </p>
          <p>
            <strong>Somar valores (agregação):</strong>
            SELECT *, (SELECT sum(idade) FROM aluno) AS soma FROM aluno;
          </p>
          <p>
            <strong>Calcular média (agregação):</strong>
            SELECT *, (SELECT avg(idade) FROM aluno) AS media FROM aluno;
          </p>
          <p>
            <strong>Contar quantas colunas tem de algo (agregação):</strong>
            SELECT *, (SELECT count(nome) FROM aluno) AS Quantidade FROM aluno;
          </p>
          <p>
            <strong>Modo fácil de escrever usando funções de agregação:</strong>
            SELECT nome, MAX (idade) FROM cliente <br />
            GROUP BY nome <br />
            HAVING max (idade) > 30;
          </p>
          <p>
            <strong>
              Modo +fácil de escrever usando funções de agregação:
            </strong>
            SELECT sum(preco) FILTER(WHERE marca = 'Swift') AS swift FROM
            produto;
          </p>
        </div>
      </section>
      <section>
        <button id="fString">
          <img src="../Imagens/circulo1.webp" alt="icone de circulo com seta" />
          <h3>Funções de Strings:</h3>
        </button>
        <div class="conteudo">
          <p>
            <strong>Contar caracteres:</strong>
            SELECT char_length(nome) FROM aluno;
          </p>
          <p>
            <strong>Contar letras (não caracteres):</strong>
            SELECT char_length(replace (nome, ' ', ' ')) FROM aluno;
          </p>
          <p>
            <strong>Colocar em FIXA (lower para diminuir):</strong> SELECT
            upper(nome) FROM aluno;
          </p>
          <p>
            <strong>Obter data atual:</strong>
            SELECT now();
          </p>
          <p>
            <strong>
              Filtrar quantos dígitos antes e depois da vírgula (D):
            </strong>
            SELECT to_char (media, '000D9') FROM aluno;
          </p>
          <p>
            <strong>
              Obter dia (day), mês (month), ano (year) de uma coluna:
            </strong>
            SELECT extract (month FROM data_mat) AS Mes FROM aluno;
          </p>
          <p>
            <strong>Filtrar quantos dígitos por data:</strong>
            SELECT to_char(data_mat, 'DD/Mon/YYY') FROM aluno;
          </p>
        </div>
      </section>
      <section>
        <button id="fPessoal">
          <img src="../Imagens/circulo1.webp" alt="icone de circulo com seta" />
          <h3>Funções de Pessoais:</h3>
        </button>
        <div class="conteudo">
          <p>
            <strong>Ver todas as funções:</strong>
            \df
          </p>
          <p>
            <strong>Apagar função:</strong>
            DROP FUNCTION somar_dias (data, integer);
          </p>
          <p>
            <strong>Criar função:</strong>
            CREATE FUNCTION somar_inteiros(int, int) RETURNS int <br />
            AS 'SELECT $1 + $2;' <br />
            LANGUAGE SQL <br />
            IMMUTABLE RETURNS NULL ON NULL INPUT;
          </p>
          <p>
            <strong>Criar função (2):</strong>
            CREATE OR REPLACE FUNCTION somar_dias (data date, dias integer)
            RETURNS date AS $$ <br />
            BEGIN <br />
            RETURN data + dias; <br />
            END; <br />
            $$ LANGUAGE psqlgsql
          </p>
          <p>
            <strong>Criar função (3):</strong>
            CREATE FUNCTION adicionar_pedido (_id, _cliente, _data) RETURNS void
            AS $$ <br />
            BEGIN <br />
            INSERT INTO pedido (id, cliente, data) <br />
            VALUES (_id, _cliente, _data); <br />
            END; <br />
            $$ LANGUAGE 'plpgsql';
          </p>
        </div>
      </section>
      <section>
        <button id="user">
          <img src="../Imagens/circulo1.webp" alt="icone de circulo com seta" />
          <h3>Privilégios (User e Role):</h3>
        </button>
        <div class="conteudo">
          <h4>
            *User ainda funciona, mas não é usado. O correto é usar Role. A
            principal diferença é que roles possuem privilégios e podem ser um
            usuário e/ou um grupo. *
          </h4>
          <p class="subtitulo">User:</p>
          <p class="subtitulo">Role:</p>
          <p>
            <strong>
              Ver todos os usuários (dentro do postgres ou outro usuário):
            </strong>
            SELECT * FROM pg_user;
          </p>
          <p>
            <strong
              >Ver todas as roles (dentro do postgres ou outro usuário):</strong
            >
            SELECT * FROM pg_roles;
          </p>
          <p>
            <strong>Criar Usuário:</strong>
            CREATE USER teste;
          </p>
          <p>
            <strong>Criar Role (2 opções pra você):</strong>
            CREATE ROLE aluno WITH LOGIN PASSWORD '12345'; <br />
            CREATE ROLE aluno NOSUPERUSER NOCREATEDB NOCREATEROLE LOGIN;
          </p>
          <p>
            <strong>Ver em qual usuário você está:</strong>
            SELECT * FROM current_user;
          </p>
          <p>
            <strong>Ver em qual role você está:</strong>
            SELECT * FROM current_role;
          </p>
          <p>
            <strong>Apagar usuário:</strong>
            DROP USER teste;
          </p>
          <p>
            <strong>Apagar role:</strong>
            DROP ROLE aluno;
          </p>
        </div>
      </section>
      <section>
        <button id="grant">
          <img src="../Imagens/circulo1.webp" alt="icone de circulo com seta" />
          <h3>Privilégios (Grant e Revoke e Schema):</h3>
        </button>
        <div class="conteudo">
          <p>
            <strong>Permitir um usuário acessar o banco:</strong>
            GRANT USAGE ON SCHEMA administrativo TO funcionario;
          </p>
          <p>
            <strong>Ver todos os Schemas (do banco):</strong>
            SELECT schema_name FROM information_schema.<wbr />schemata;
          </p>
          <p>
            <strong>
              Garantir privilégios à um usuário (estagiario) (trocar o update,
              selects por ALL, para todos):
            </strong>
            GRANT UPDATE, SELECT ON TABLE funcionarios TO estagiario;
          </p>
          <p>
            <strong>
              Revogar privilégios à um usuário (estagiario) (trocar o update,
              select por ALL, para todos):
            </strong>
            REVOKE UPDATE, SELECT ON TABLE funcionarios FROM estagiario;
          </p>
          <p>
            <strong>Criar Schema:</strong>
            CREATE SCHEMA administrativo;
          </p>
          <p>
            <strong>Criar Tabela dentro do Schema (administrativo):</strong>
            CREATE TABLE administrativo.<wbr />funcionario (cod INT);
          </p>
          <p>
            <strong>
              Garantir privilégio às tabelas de um schema para 1 usuário:
            </strong>
            GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA empresa TO aluno;
          </p>
          <p>
            <strong>
              Revogar privilégio às tabelas de um schema para 1 usuário:
            </strong>
            REVOKE ALL PRIVILEGES ON ALL TABLES IN SCHEMA empresa FROM aluno;
          </p>
          <p>
            <strong>Visualizar as permissões de cada usuário</strong>
            SELECT * FROM information_schema.table_privileges
          </p>
        </div>
      </section>
      <section>
        <button id="view">
          <img src="../Imagens/circulo1.webp" alt="icone de circulo com seta" />
          <h3>View e Trigger:</h3>
        </button>
        <div class="conteudo">
          <p>
            <strong>Ver todas as Views:</strong>
            \d+
          </p>
          <p>
            <strong>Criar View:</strong>
            CREATE VIEW vw_aluno15 AS <br />
            SELECT * FROM aluno WHERE idade = 15;
          </p>
          <p>
            <strong>Criar função de trigger:</strong>
            CREATE OR REPLACE FUNCTION data_cadastro() <br />
            RETURNS TRIGGER AS $$ <br />
            BEGIN <br />
            NEW.data_cadastro = now(); <br />
            RETURN NEW; <br />
            END; <br />
            $$ language 'plpgsql'; <br />
          </p>
          <p>
            <strong>Criar trigger:</strong>
            CREATE TRIGGER data_cadastro_novoCliente <br />
            BEFORE INSERT ON cliente <br />
            FOR EACH ROW <br />
            EXECUTE PROCEDURE data_cadastro();
          </p>
          <p>
            <strong>Apagar trigger:</strong>
            DROP TRIGGER data_cadastro_novoCliente ON cliente;
          </p>
        </div>
      </section>
      <section>
        <button id="procedure">
          <img src="../Imagens/circulo1.webp" alt="icone de circulo com seta" />
          <h3>Procedure:</h3>
        </button>
        <div class="conteudo">
          <p>
            <strong>Criar Procedure Simples:</strong>
            CREATE or REPLACE PROCEDURE limpaAluno() <br />
            language 'plpgsql' <br />
            AS $$ BEGIN <br />
            TRUNCATE TABLE aluno; <br />
            COMMIT; END; $$; <br />
          </p>
          <p>
            <strong>Criar Procedure Complexa:</strong>
            CREATE OR REPLACE PROCEDURE limpaAluno() <br />
            language 'plpgsql' AS $$ <br />
            DECLARE <br />
            menor_media INT; <br />
            maior_media INT; <br />
            BEGIN <br />
            SELECT MIN(media) FROM aluno INTO menor_media; <br />
            SELECT MAX(media) FROM aluno INTO maior_media; <br />
            <br />
            IF menor_media &lt; 0 or maior_media &gt; 10 THEN <br />
            TRUNCATE TABLE aluno; <br />
            <br />
            ELSE <br />
            RAISE INFO 'Tudo certo na tabela Aluno'; <br />
            END IF; <br />
            COMMIT; END; $$; <br />
          </p>
          <p>
            <strong>Realizar comandos da Procedure:</strong>
            CALL limpaAluno();
          </p>
          <p>
            <strong>Apagar Procedure:</strong>
            DROP PROCEDURE limpaAluno();
          </p>
        </div>
      </section>
      <section>
        <button id="json">
          <img src="../Imagens/circulo1.webp" alt="icone de circulo com seta" />
          <h3>Json:</h3>
        </button>
        <div class="conteudo">
          <p>
            <strong>
              Selecionar um item da coluna json (2 setas para ser texto):
            </strong>
            SELECT informacoes_adicionais-&gt; 'idade' FROM pessoa;
          </p>
          <p>
            <strong>Ver valores de lista que precisam ter estes intens:</strong>
            SELECT * FROM pessoas WHERE hobbies @&gt; '[“programacao”,
            “leitura”]'';
          </p>
          <p>
            <strong>
              Ver valores de lista que só tem algum destes itens mencionados:
            </strong>
            SELECT * FROM pessoa WHERE hobbies &lt;@ '[“leitura”, “programação”,
            “dança”]';
          </p>
          <p>
            <strong>Ver as chaves da coluna:</strong>
            SELECT DISTINCT jsonb_object_keys(pedido) FROM compras;
          </p>
          <p>
            <strong>Ver chave e valor (tupla) da coluna:</strong>
            SELECT jsonb_each(pedido) FROM compras;
          </p>
          <p>
            <strong>Ver tipo do valor da chave:</strong>
            SELECT DISTINCT jsonb_typeof (pedido-&gt;'produtos'-&gt;'bebidas')
            FROM compras;
          </p>
        </div>
      </section>
    </main>

    <footer></footer>
  </body>
</html>
